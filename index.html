<!DOCTYPE html>

<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><span id="visitor-count">Загрузка...</span></title>
    <style>
        body {
            margin: 0; /* Убираем все отступы по умолчанию */
            display: flex;          /* Используем flexbox */
            flex-direction: column;  /* Размещаем элементы вертикально */
            justify-content: center; /* Выравниваем по вертикали */
            align-items: center;     /* Выравниваем по горизонтали */
            min-height: 100vh;       /* Занимаем всю высоту экрана */
            background-color: #f0f0f0; /* Светлый фон */
        }

        video {
            max-width: 101%; /* Максимальная ширина видео (80% экрана) */
            max-height: 101vh;/* Максимальная высота видео (80% экрана)*/
            margin-bottom: 20px; /* Отступ между видео и счетчиком */
        }
    </style>
</head>
<body>

    <video controls>
        <source src="smeshno.mp4" type="video/mp4">
        Ваш браузер не поддерживает HTML5 видео.
    </video>

    <p>Просмотров: <span id="visitor-count">Загрузка...</span></p>

    <!-- Добавляем Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <script>
      // Конфигурация Firebase (замените своими данными)
      const firebaseConfig = {
  apiKey: "AIzaSyCLirDt-5tmT4AQnVJKiMmwvV1GjcPMBGM",
  authDomain: "funnyqrcounter.firebaseapp.com",
  projectId: "funnyqrcounter",
  storageBucket: "funnyqrcounter.firebasestorage.app",
  messagingSenderId: "1012953083960",
  appId: "1:1012953083960:web:48dd5a68d64249e59ab6cd"
};

      // Инициализация Firebase
      firebase.initializeApp(firebaseConfig);

      const db = firebase.database();
      const counterRef = db.ref("visitors"); // Ссылка на счетчик в базе данных

      function incrementCounter() {
        counterRef.transaction((currentValue) => {
          return (currentValue || 0) + 1;
        }, (error, committed, snapshot) => { // Обработчик завершения транзакции
           if (error) {
              console.log('Transaction failed abnormally!', error);
           } else if (!committed) {
              console.log('Transaction aborted by the server.');
           } else {
              console.log('Transaction committed!');
           }
        });
      }

      function displayCount() {
        counterRef.get().then((snapshot) => {
          if (snapshot.exists()) {
            document.getElementById("visitor-count").textContent = snapshot.val();
          } else {
            document.getElementById("visitor-count").textContent = "0";
            counterRef.set(0); // Устанавливаем начальное значение, если счетчик еще не создан
          }
        }).catch((error) => {
          console.error(error);
          document.getElementById("visitor-count").textContent = "Ошибка загрузки";
        });
      }

      // Вызываем функции
      incrementCounter(); // Увеличиваем счетчик при загрузке страницы
      displayCount();      // Отображаем текущее значение счетчика
</script>
</body>
</html>
